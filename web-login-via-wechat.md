---
title:  为网页增加微信登录功能
heading: 
date: 2019-12-10T02:47:27.052Z
categories: ["code"]
tags: 
description: 
---

简略图如下

![enter description here](https://gitee.com/smile365/blogimg/raw/master/sxy91/1575965856996.png)

## 登录页面

1. 用户点击留言按钮(也可以是注册/登录等)
2. 服务器记录：uuid/ip/时间/ua/上次验证时间/验证次数/发起页面url。
3. 服务器返回：uuid，微信订阅号二维码，并显示二维码(界面2)。
4. 定时循环查询后台是否存在事件，有则跳转到界面3。超过20秒后显示“我已扫描”按钮，点击可跳转到界面3。
5. 用户扫描二维码，产生特定事件(关注/点击菜单/回复)。
6. 服务器回复邀请码(也可以叫其他)。
7. 用户在界面3填写邀请码，点击下一步(也可以叫登录/注册/验证/确定等)。
8. 服务器根据邀请码查询，验证通过后返回用户昵称/头像/token。token留作其他接口使用。


## 注意

需要注意ddos攻击和邀请码暴力查询。
前期版本2/3步骤可省略，直接显示二维码。
邀请码4～6位，10分钟内有效。


## 优化

还有很多优化空间。
需要避免恶意抢注册，恶意获取用户信息，以及恶意获取token并伪装成真实用户等。
